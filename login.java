This is some fix done by jerry on top of tom's work.
